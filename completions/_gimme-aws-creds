#compdef gimme-aws-creds
#autoload

_gimme-aws-creds() {
    _arguments '-p+[AWS Profiles]:Profiles:->profiles'
    env | tee /tmp/gac_comp.log
    printf 'state=%s' "$state" | tee -a /tmp/gac_comp.log
    case "$state" in
        (profiles) _profiles ;;
    esac
}

_profiles() {
    local IFS=$'\n'
    _values 'Profiles' $(gimme-aws-creds --list-profiles | sed -En 's/\[(.+)\]/\1/p' | grep "${IPREFIX#-p}")
}

_gimme-aws-creds
